<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>bwelco</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="bwelco">
<meta property="og:url" content="http://bwelco.github.io/index.html">
<meta property="og:site_name" content="bwelco">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="bwelco">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="bwelco" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://o8yrrj7hr.bkt.clouddn.com/HexoHead.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">bwelco</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/bwelco" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/bwelco" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/feng-guang-80" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:morefreefg@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Android/" style="font-size: 13.33px;">Android</a> <a href="/tags/C语言/" style="font-size: 10px;">C语言</a> <a href="/tags/Linux/" style="font-size: 16.67px;">Linux</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/openwrt/" style="font-size: 20px;">openwrt</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">大风从东刮到西，从北刮到南，无视黑夜和黎明，你所说的曙光究竟是什么意思。</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">bwelco</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://o8yrrj7hr.bkt.clouddn.com/HexoHead.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">bwelco</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/bwelco" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/bwelco" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="https://www.zhihu.com/people/feng-guang-80" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:morefreefg@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-三星长按Home键搜索" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/06/19/三星长按Home键搜索/" class="article-date">
  	<time datetime="2016-06-20T02:10:00.000Z" itemprop="datePublished">2016-06-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/06/19/三星长按Home键搜索/">三星长按Home键搜索</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>手持一部Samsung Galaxy S7 Edge。长按Home键可以进行相关的操作，但是不是在默认程序里面设置的。<br>要跳转到专门的设置里面。<br>三星官方也并没有提供这个接口，Google一圈也搜索不到。<br>里面默认选择的除了三星自家的软件还有一个手机百度。长按Home键可以进行搜索。<br>这就很不爽了，难道我只能忍受百度这个大毒瘤么，要知道长按home键搜索也是个很实用的功能。</p>
<p>身为程序狗，默默打开反编译软件，结果看代码看了一圈也没什么相关的地方。这时候我扫了一眼AndroidMainfest。在相关Activity的标签下看到了这个<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.ASSIST"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ASSIST，设置那边也叫ASSIST， 这个应该逃不掉了吧。<br>好的。正文开始了。</p>
<p>下面就是做搜索界面，还是看百度的AndroidMainfest。这个标签下， android:theme=”@style/NoTitleNoAnimationNoBackground”<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> &lt;style <span class="built_in">name</span>=<span class="string">"NoTitleNoAnimationNoBackground"</span> parent=<span class="string">"@style/NoTitle"</span>&gt;</span><br><span class="line">     &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowBackground"</span>&gt;@color/fast_search_activity_transparent&lt;/<span class="built_in">item</span>&gt;</span><br><span class="line">     &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowIsTranslucent"</span>&gt;<span class="literal">true</span>&lt;/<span class="built_in">item</span>&gt;</span><br><span class="line">     &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowAnimationStyle"</span>&gt;@null&lt;/<span class="built_in">item</span>&gt;</span><br><span class="line"> &lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;style <span class="built_in">name</span>=<span class="string">"NoTitle"</span> parent=<span class="string">"@android:style/Theme.NoTitleBar"</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowBackground"</span>&gt;@color/window_background_color&lt;/<span class="built_in">item</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">"android:windowContentOverlay"</span>&gt;@null&lt;/<span class="built_in">item</span>&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></p>
<p>这就可以实现背景透明了。</p>
<p>下面就是写个EditText，然后加一个ListView。<br>问题来了，listview数据哪里来。  百度并没有提供相关接口，怎么办呐？</p>
<p>抓包大法吼啊，开FireFox debug控制台，搜到相关接口是<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>//suggestion.baidu.com/su?action=opensearch&amp;wd=<span class="string">"keyword"</span></span><br></pre></td></tr></table></figure></p>
<p>返回一个json，自己解析下放到listView里面就行。</p>
<p>相关代码放到GitHub上面了</p>
<p><a href="https://github.com/bwelco/SumsungSearch/" target="_blank" rel="external">https://github.com/bwelco/SumsungSearch/</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-远程app使用教程及下载" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/09/22/远程app使用教程及下载/" class="article-date">
  	<time datetime="2015-09-23T01:21:00.000Z" itemprop="datePublished">2015-09-22</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/09/22/远程app使用教程及下载/">远程app使用教程及下载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="远程app使用教程及下载"><a href="#远程app使用教程及下载" class="headerlink" title="远程app使用教程及下载"></a>远程app使用教程及下载</h1><p>昨天写了个小程序。app控制电脑音量（送给苦于舍友放歌却屡教不改的童鞋。）</p>
<p>使用教程：</p>
<p>1：电脑端安装。 先把WindowsService.exe放入D盘的根目录下（直接把文件拖到d盘就行），然后右击install.bat，点击以管理员身份运行。360或者其他软件报毒的，如果你信任我就设置为信任，不要让360瞎bb。</p>
<p>安装过后，打开D盘下的MoreFree.txt</p>
<p><img src="http://o8yrrj7hr.bkt.clouddn.com/QQ%E5%9B%BE%E7%89%8720150622132358.png" alt="1"></p>
<p>如果不出错的话，可以看到 绑定ip：×××.×××.×××.×××</p>
<p>把这个ip填到手机app里面即可。</p>
<p>然后，请打开控制面板，搜索防火墙关键字，关闭防火墙。</p>
<p><img src="http://o8yrrj7hr.bkt.clouddn.com/U8T66DJ@B7@JOR9UA58.png" alt="2"></p>
<p>2：安卓，直接安装apk就行。</p>
<p>Tips：能使用的前提是，你手机跟被控制的电脑在同一局域网下面。</p>
<p>如果出错。</p>
<p>1：安装出错，请截图安装过程（运行install.bat的时候）。</p>
<p>2：运行出错，请打开D盘下的MoreFree.txt，并发给我，我给你分析。</p>
<p>卸载：</p>
<p>右击uninstall.bat，点击以管理员身份运行。</p>
<p><img src="http://o8yrrj7hr.bkt.clouddn.com/QQ%E5%9B%BE%E7%89%8720150622131932.png" alt="3"></p>
<p>APP截图:</p>
<p><img src="http://o8yrrj7hr.bkt.clouddn.com/Screenshot_2015-06-22-20-12-00.png" alt="4"></p>
<p><a href="http://o8yrrj7hr.bkt.clouddn.com/%E5%AE%A2%E6%88%B7%E7%AB%AF.zip" target="_blank" rel="external">点击此处下载</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows/">Windows</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-解决socket传输中数据丢失问题" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/07/18/解决socket传输中数据丢失问题/" class="article-date">
  	<time datetime="2015-07-18T08:20:00.000Z" itemprop="datePublished">2015-07-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/18/解决socket传输中数据丢失问题/">解决socket传输中数据丢失问题</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[原创]欢迎转载。注明出处。</p>
<p>最近写一个小程序，想要添加文件上传/下载功能。</p>
<p>原始代码： client (send):</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    read(fd, <span class="keyword">buff,BUFF_SIZE);</span><br><span class="line"></span></span><br><span class="line">    send(soc, <span class="keyword">buff, </span><span class="keyword">BUFF_SIZE, </span><span class="number">0</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sever (receive):</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span><span class="comment">(1)</span></span><br><span class="line">&#123;</span><br><span class="line">    recv<span class="comment">(soc, buff, BUFF_SIZE, 0)</span>;</span><br><span class="line"></span><br><span class="line">    write<span class="comment">(fd, buff,BUFF_SIZE)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>奇怪的现象出现了，客户端一路到头，send函数和recv也没有出现任何错误，但是，文件大小严重缩水。<br>我又把buff重新设计，包含在结构体里面，里面包含检验信息flag，来保证两头传输正常。发现，在收发包的过程中，flag丢失。</p>
<p>难道是tcp丢包？上网查看相关资料，据说是tcp粘包（我也不太清楚具体问题），因为路由或者系统一般都把MTU限制在1500，如果数据包超过这数值，就会被拆封成小包来保证数据的准确性。</p>
<p>那问题就显而易见了，send传输太快，导致传输出现差错。于是，第一时间想到的是，在客户端或者服务器中加入unsleep()；</p>
<p>试了下，一开始unsleep的值很小的时候，传输还会出现差错。一步一步调试，在sever中加入recv返回值检验，recv返回值有三种情况，<0：传输失败、=0：另一端关闭、>0，返回成功收到的字节数。于是我加上了返回值检验，一旦返回值小于规定的返回值立刻停止传输，然后慢慢调整unsleep的值。可是，问题依然还有，这样虽然传输不会出现差错，可是速度立马降下来了，局域网之间传输只有80kb/s。。。</0：传输失败、=0：另一端关闭、></p>
<p>这时候。recv的最后一个参数引起了我的注意，这个参数一般默认设为0。会不会有其他参数能解决我这问题呢。man 2 recv，查阅数据手册<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SYNOPSIS</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">ssize_t recv(<span class="built_in">int</span> s, void *buf, size_t len, <span class="built_in">int</span> flags)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">这是对recv函数的说明，翻到flag，有一个宏参数。</span><br><span class="line"></span><br><span class="line">MSG_WAITALL</span><br><span class="line">This flag requests that the operation block <span class="keyword">until</span> the full</span><br><span class="line">request is satisfied. However, the <span class="built_in">call</span> may still <span class="keyword">return</span> less</span><br><span class="line">data than requested <span class="keyword">if</span> a signal is caught, an error <span class="literal">or</span> discon-</span><br><span class="line">nect occurs, <span class="literal">or</span> the <span class="keyword">next</span> data <span class="keyword">to</span> be received is of a different</span><br><span class="line">type than that returned.</span><br></pre></td></tr></table></figure></p>
<p>大概意思就是，正常情况下，如果不设置MSG_WAITALL,那么系统使用SO_RCVLOWAT和参数length这两者较小的值，如果设置MSG_WAITALL那么使用参数length的值，如果前面计算的长度值为0，那么使用长度1，最后当socket读到的数据满足前面的长度时才返回。由于默认SO_RCVLOWAT为1字节长，所以可以认为，当不设置MSG_WAITALL时只要大于一个字节的数据就立即返回，而设置MSG_WAITALL时不少于length参数长度时才返回。</p>
<p>这样传输速度的问题就解决了。实测可以达到6 mb/s。哈哈。很理想了。</p>
<p>下面是整个代码，包含文件长度检验、上传进度、消耗时间、网速模拟等等<br>client:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    ret = read(file, file_send_buf.buff, BUFF_MAX);</span><br><span class="line">    size_all_temp = size_all_temp + BUFF_MAX;</span><br><span class="line"></span><br><span class="line">    file_send_buf.flag = <span class="number">1001</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((ret &gt;= <span class="number">0</span>) &amp;&amp; (ret &lt; BUFF_MAX))</span><br><span class="line">    &#123;</span><br><span class="line">        file_send_buf.last_file_size = ret;</span><br><span class="line">        file_send_buf.flag = <span class="number">1000</span>;</span><br><span class="line">        send(soc, &amp;file_send_buf, <span class="keyword">sizeof</span>(<span class="class"><span class="keyword">struct</span> <span class="title">file_send_recv</span></span>), MSG_WAITALL);</span><br><span class="line">        break_flag = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == ret)</span><br><span class="line">    &#123;</span><br><span class="line">        perror(read);</span><br><span class="line">        exit(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> != break_flag)</span><br><span class="line">    &#123;</span><br><span class="line">    	send(soc, &amp;file_send_buf, <span class="keyword">sizeof</span>(<span class="class"><span class="keyword">struct</span> <span class="title">file_send_recv</span></span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    memset(&amp;file_send_buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="class"><span class="keyword">struct</span> <span class="title">file_send_recv</span></span>));</span><br><span class="line">    <span class="comment">//usleep(10000);</span></span><br><span class="line"></span><br><span class="line">    file_size_uploaded_temp = i * BUFF_MAX;</span><br><span class="line">    file_size_uploaded = (<span class="keyword">float</span>)file_size_uploaded_temp;</span><br><span class="line">    percent = (file_size_uploaded / file_size) * <span class="number">100</span>;</span><br><span class="line">    mvwprintw(file_upload_win, <span class="number">1</span>, <span class="number">1</span>, <span class="string">" UPLOAGING… "</span>);</span><br><span class="line"></span><br><span class="line">    wattron(file_upload_win, COLOR_PAIR(<span class="number">7</span>));</span><br><span class="line">    wprintw(file_upload_win, <span class="string">"%4.2f%% "</span>, percent);</span><br><span class="line">    wattroff(file_upload_win, COLOR_PAIR(<span class="number">7</span>));</span><br><span class="line">    wprintw(file_upload_win, <span class="string">"%s "</span>, internet_speed);</span><br><span class="line"></span><br><span class="line">    uploaded_per = (<span class="keyword">int</span>)((percent / <span class="number">100</span>) * (width – <span class="number">2</span>));</span><br><span class="line">    wmove(file_upload_win, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    wattron(file_upload_win, COLOR_PAIR(<span class="number">6</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(temp = <span class="number">0</span>; temp &lt; uploaded_per; temp++)</span><br><span class="line">    &#123;</span><br><span class="line">    	wprintw(file_upload_win, <span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    wattroff(file_upload_win, COLOR_PAIR(<span class="number">6</span>));</span><br><span class="line"></span><br><span class="line">    wattron(file_upload_win, COLOR_PAIR(<span class="number">5</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(temp = <span class="number">0</span>; temp &lt; (COLS / <span class="number">2</span> – <span class="number">2</span> – uploaded_per); temp++)</span><br><span class="line">    &#123;</span><br><span class="line">   		 wprintw(file_upload_win, <span class="string">" "</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    wattroff(file_upload_win, COLOR_PAIR(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    mvwprintw(file_upload_win, <span class="number">3</span>, <span class="number">1</span>, <span class="string">" Time passed: %ds File size:%s "</span> , second, file_size_format);</span><br><span class="line"></span><br><span class="line">    wborder(file_upload_win, ‘<span class="params">|’, ‘|</span>’, ‘-’,'-’,'+’,'+’,'+’,'+’);</span><br><span class="line">    wrefresh(file_upload_win);</span><br><span class="line">    wmove(send_msg_win, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    wrefresh(send_msg_win);</span><br><span class="line">    i++;</span><br><span class="line"></span><br><span class="line">    time(&amp;time_middle);</span><br><span class="line">    speed_temp = second;</span><br><span class="line">    second = difftime(time_middle, time_begin);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(second != speed_temp)</span><br><span class="line">    &#123;</span><br><span class="line">        get_internet_speed(size_all_temp, internet_speed);</span><br><span class="line">        size_all_temp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span> == break_flag)</span><br><span class="line">    &#123;</span><br><span class="line">   		 <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>server:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    i++;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;rece_file, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> file_send_recv));</span><br><span class="line">    ret = recv(soc, &amp;rece_file, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> file_send_recv), MSG_WAITALL);</span><br><span class="line">    <span class="keyword">if</span>(ret == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">    perror(recv);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">1000</span> == rece_file.flag)</span><br><span class="line">&#123;</span><br><span class="line">    write(file, rece_file.buff, rece_file.last_file_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"File_recv_over\n"</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    ret = write(file, rece_file.buff, BUFF_MAX);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">-1</span> == ret)</span><br><span class="line">    &#123;</span><br><span class="line">    perror(write);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试效果图：</p>
<p><img src="http://o8yrrj7hr.bkt.clouddn.com/QQ%E5%9B%BE%E7%89%8720150217232414.png" alt="1"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-编译openwrt时覆盖配置文件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/03/30/编译openwrt时覆盖配置文件/" class="article-date">
  	<time datetime="2015-03-30T15:52:00.000Z" itemprop="datePublished">2015-03-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/30/编译openwrt时覆盖配置文件/">编译openwrt时覆盖配置文件</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="编译openwrt时覆盖配置文件"><a href="#编译openwrt时覆盖配置文件" class="headerlink" title="编译openwrt时覆盖配置文件"></a>编译openwrt时覆盖配置文件</h1><p>最近又重操旧业，把openwrt拿出来玩。</p>
<p>一直以来想解决的问题，今天终于在google上搜到，留作备忘（我就不说百度有多渣了）</p>
<p>当学会了搭建openwrt编译环境，肯定是想编译有一些自己想要的东西固件，要知道官方给的固件是很简洁的，不仅没有web界面(Luci-web)，连无线默认都不是开启的，这也太不像个无线路由器的样子了。</p>
<p>我们会使用make kernelconfig和make menuconfig这种方法来自定义软件包，不过，这样编译出来的固件仍然不具个性化，因为，无线仍然没有开启，像SSID、路由主机名、默认网关等等这些还是openwrt官方的默认值。那么现在，我们就通过接下来的步骤做些个性化的修改。</p>
<p>在编译目录下新建一个名为files的目录，openwrt在编译的时候，会把files文件夹里的文件编译到固件的根目录，简而言之，就是/openwrt/trunk/files目录，这相当于是openwrt固件的根目录/（这个和上面提及的/openwrt/trunk/package/base-files/files目录作用相似），所以能在这个目录下能干的事情就多了，基本上涵盖了所有你能改动的东西。</p>
<p>这里只要模仿openwrt的/etc目录修改配置文件就可以了，下面对这些目录及文件作简单说明：</p>
<table>
<thead>
<tr>
<th>Tables</th>
<th style="text-align:center">Are</th>
</tr>
</thead>
<tbody>
<tr>
<td>/www/</td>
<td style="text-align:center">luci web页面的目录。</td>
</tr>
<tr>
<td>/etc/banner</td>
<td style="text-align:center">命令行登陆Openwrt的欢迎信息</td>
</tr>
<tr>
<td>/etc/opkg.conf</td>
<td style="text-align:center">Openwrt的opkg更新源配置文件</td>
</tr>
<tr>
<td>/etc/profile</td>
<td style="text-align:center">系统环境变量</td>
</tr>
<tr>
<td>/etc/dnsmasq.conf</td>
<td style="text-align:center">Dns解析配置文件</td>
</tr>
<tr>
<td>/etc/config/dhcp</td>
<td style="text-align:center">Dhcp服务配置文件</td>
</tr>
<tr>
<td>/etc/config/firewall</td>
<td style="text-align:center">防火墙配置文件</td>
</tr>
<tr>
<td>/etc/config/fstab</td>
<td style="text-align:center">文件系统挂载配置文件</td>
</tr>
<tr>
<td>/etc/config/luci</td>
<td style="text-align:center">Luci界面配置文件</td>
</tr>
<tr>
<td>/openwrt/trunk/package/base-files/files/etc/config/system</td>
<td style="text-align:center">系统主机名、时区、NTP及LED配置文件</td>
</tr>
<tr>
<td>/etc/config/wireless</td>
<td style="text-align:center">无线配置文件</td>
</tr>
</tbody>
</table>
<p>注意：编译openwrt是不能使用root账户的，别忘记配置好/openwrt/trunk/files目录属组及权限，不然编译时会出现各种奇葩的问题。最懒得方法是把权限改成777，命令：chmod 777 /openwrt/trunk/files -R</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openwrt/">openwrt</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-To-Fast-Furious" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/03/25/To-Fast-Furious/" class="article-date">
  	<time datetime="2015-03-25T13:59:00.000Z" itemprop="datePublished">2015-03-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/25/To-Fast-Furious/">To Fast &amp; Furious</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最后一段可能会是我观影史上最喜欢的谢幕，它以一个最完美的方式给保罗做了告别。</p>
<p>在这最后一幕，出场的两位主角不再是 DOM 与奥康纳，而就是范迪塞尔和保罗，在这段的表演个人觉得已经超脱于表演了，这段是拍给保罗的，也是拍给范迪塞尔的，更是拍给所有从速激1一路跟过来的老观众的。</p>
<p>结幕开场时，DOM一个人开车正在离开，他脸上展现了一种不属于DOM 这个角色的伤感、无奈。很明显这时的表情属于范迪塞尔，然后 背景音乐《SEE YOU AGAIN》的主旋律响起，“奥康纳”驾驶了一架纯白的跑车从 DOM 的一旁出现了。</p>
<p>“Thought you gonna leave without saying goodbye?” 奥康纳问，脸上露出了灿烂的笑容。</p>
<p>CG 合成的保罗的脸几乎完全无法看出瑕疵，他灿烂地微笑着，把正在观影的我也从感伤于失去保罗的情绪拉回到了“奥康纳”身上来。在银屏上的奥康纳没有因车祸而亡，而是从此金盆洗手，与妻儿共享天伦之余，还能与兄弟开车并驾齐驱。此刻的奥康纳是最幸福的奥康纳。</p>
<p>刚刚愁云密布的DOM 在看到奥康纳后也浮现了笑容，而我不觉得范迪塞尔此时的笑容属于表演，他笑时的眼神里还是有着悲伤，但他的笑容却也丝毫没有虚假的痕迹，这笑容可能就是范迪塞尔当时的情绪，他应该是真的很高兴，也很释然。</p>
<p>保罗与范迪塞尔戏里戏外都是兄弟，戏里DOM为奥康纳这个兄弟感到高兴，戏外范迪塞尔也可能应该感觉到了保罗在天堂对他发自内心的微笑，This is the one last ride, brother.</p>
<p>接着二人便开始了每部结尾必有的“一对一飙车“，但这次二人完全没有了往日地极速奔驰、你争我赶的架势，而是一直缓缓地，平静地并驾齐驱，</p>
<p>此时画面开始闪回速激1-6中 DOM 和奥康纳从青涩到成熟的画面，背景音乐也越来越激昂。</p>
<p>当闪回结束，镜头回到二人时，一个向西的分岔路出现了，奥康纳缓缓地向西驶去，DOM 继续向前，二人并没有说再见，也没有回头。两辆车平稳而坚定地向各自的方向驶去。</p>
<p>航拍镜头逐渐升高，跟着奥康纳的白色跑车往远景的阳光驶去，画面十分温暖，背景音乐也达到了最高潮的和声部分。奥康纳与保罗驶向了阳光，奥康纳回到了温暖的家，保罗则去到了一个更好的地方。</p>
<p>最后的这幕不是表演，它不是普普通通能演出来的，这一幕的感情太过真挚，不管何时回想都让我无比震撼与感动</p>
<p>最后引用一下DOM对保罗最后的台词作结吧</p>
<p>“I used to say I live my life a quarter mile at a time and I think that’s why we were brothers- because you did, too. No matter where you are, whether it’s a quarter mile away or half way across the world. The most important thing in life, will always be the people in this room. Salute mi familia. You’ll always be with me… And you’ll always be my brother.”</p>
<p>For Paul</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/电影/">电影</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Openwrt拨号结果" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/01/11/Openwrt拨号结果/" class="article-date">
  	<time datetime="2015-01-12T06:22:00.000Z" itemprop="datePublished">2015-01-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/11/Openwrt拨号结果/">Openwrt拨号结果</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>目前只是一个linux 文件编程小练习，在openwrt shell下面可以正常运行。至于在luci上。。有一个函数</p>
<p>luci.sys.exec (command)  </p>
<p>Execute a given shell command and capture its standard output</p>
<p>参考 ：<a href="http://luci.subsignal.org/api/luci/modules/luci.sys.html" target="_blank" rel="external">http://luci.subsignal.org/api/luci/modules/luci.sys.html</a></p>
<p>大家可以试试,这里面的command是dial_result。</p>
<p>下面提供源码，大家可以根据自己的喜好改makefile定义自己的command</p>
<p>c代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> * <span class="title">found</span><span class="params">(<span class="keyword">char</span> *ptr)</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> success[] = <span class="string">"CHAP authentication succeeded: "</span>;</span><br><span class="line"><span class="keyword">char</span> fail[] = <span class="string">"CHAP authentication failed: "</span>;</span><br><span class="line"><span class="keyword">char</span> unable[] = <span class="string">"Unable to complete PPPoE Discovery"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *succ = success;</span><br><span class="line"><span class="keyword">char</span> *fai = fail;</span><br><span class="line"><span class="keyword">char</span> *unab = unable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *temp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> flag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(*ptr != ‘\<span class="number">0</span>’)</span><br><span class="line">&#123;</span><br><span class="line">temp = ptr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(*ptr == *unab ) <span class="comment">//unable</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(*ptr == *unab)</span><br><span class="line">&#123;</span><br><span class="line">ptr++;</span><br><span class="line">unab++;</span><br><span class="line"><span class="keyword">if</span>(*ptr == ‘v’)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(*ptr == ‘v’)</span><br><span class="line">&#123;</span><br><span class="line">ptr = temp;</span><br><span class="line"><span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ptr = temp;</span><br><span class="line">unab = unable;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(*ptr == *succ) <span class="comment">//success</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(*ptr == *succ)</span><br><span class="line">&#123;</span><br><span class="line">ptr++;</span><br><span class="line">succ++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(*succ == ‘\<span class="number">0</span>’)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ptr = temp;</span><br><span class="line">succ = success;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(*ptr == *fai) <span class="comment">//fail</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span>(*ptr == *fai)</span><br><span class="line">&#123;</span><br><span class="line">ptr++;</span><br><span class="line">fai++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(*fai == ‘\<span class="number">0</span>’)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ptr = temp;</span><br><span class="line">fai = fail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ptr++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read_line</span><span class="params">(<span class="keyword">int</span> flag,<span class="keyword">char</span> *temp,<span class="keyword">int</span> len)</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">char</span> tem;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>;i &lt; len; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(read(flag,&amp;tem,<span class="number">1</span>) &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"read error"</span>);</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(tem == ‘\n’)</span><br><span class="line">&#123;</span><br><span class="line">temp[i] = ‘\<span class="number">0</span>’;</span><br><span class="line"><span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp[i] = tem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp[i] = ‘\<span class="number">0</span>’;</span><br><span class="line"><span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">dial</span><span class="params">(<span class="keyword">char</span> *txt)</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> flag; <span class="comment">//dial_txt</span></span><br><span class="line"><span class="keyword">int</span> end;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> *resul;</span><br><span class="line"><span class="keyword">char</span> end_file;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> temp[<span class="number">500</span>];</span><br><span class="line"><span class="keyword">char</span> c[<span class="number">1000</span>];</span><br><span class="line"><span class="keyword">char</span> dial_result[<span class="number">10</span>][<span class="number">50</span>];</span><br><span class="line"></span><br><span class="line">flag = open(txt, O_RDWR,<span class="number">0655</span>); <span class="comment">//open dial_txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="number">-1</span> == flag)</span><br><span class="line">&#123;</span><br><span class="line">perror(<span class="string">"error :"</span>); <span class="comment">//open error</span></span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lseek(flag,<span class="number">0</span>,SEEK_SET);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memset</span>(temp,<span class="number">0</span>,<span class="keyword">sizeof</span>(temp));</span><br><span class="line">read_line(flag,temp,MAX);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(end = read(flag,&amp;end_file,<span class="number">1</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lseek(flag,<span class="number">-1</span>,SEEK_CUR);</span><br><span class="line">resul = found(temp);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(resul != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">strcpy</span>(dial_result[j], resul);</span><br><span class="line">j++;</span><br><span class="line">resul = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">close(flag);</span><br><span class="line"><span class="keyword">if</span>(j == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Dialing,Please wait for a while!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dial_result[j];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">system(<span class="string">"logread &gt; /tmp/logread.txt"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> txt[<span class="number">100</span>] = <span class="string">"/tmp/logread.txt"</span>;</span><br><span class="line"><span class="keyword">char</span> *temp = dial(txt);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(temp != <span class="string">"Dialing,Please wait for a while!"</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%s\n"</span>,temp);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Dialing,Please wait for a while!\n"</span>);</span><br><span class="line">sleep(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openwrt/">openwrt</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Openwrt-SDK-编译生成ipk过程" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/30/Openwrt-SDK-编译生成ipk过程/" class="article-date">
  	<time datetime="2014-07-01T06:19:00.000Z" itemprop="datePublished">2014-06-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/30/Openwrt-SDK-编译生成ipk过程/">Openwrt SDK 编译生成ipk过程</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先你要了解自己的openwrt版本号，以及自己的cpu构架。<br>ipk包是在一个构架里面的所有cpu的都能运行的，所以，比如你ipk在AR9331上能运行，也能在AR9344、AR9341…所有AR71XX构架的cpu上运行，但是在写一些特殊程序的时候，需要根据机型来安装。<br>进入<a href="http://downloads.openwrt.org" target="_blank" rel="external">http://downloads.openwrt.org</a> 里面选择你的openwrt版本号。进而选择自己的构架，然后找到sdk。</p>
<p>以AR71XX的AA版本为例(attitude_adjustment)，<a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/" target="_blank" rel="external">http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/</a></p>
<p>选择OpenWrt-SDK-ar71xx-for-linux-i486-gcc-4.6-linaro_uClibc-0.9.33.2.tar.bz2，下载到本地，并传到虚拟机里面。</p>
<p>新建自己的packages<br>对于自己新建的package，而这个package又不需要随固件一起安装，换句话说，就是可以当做一个可选软件包的话。我们可以利用我们的SDK环境来单独编译，编译后会生成一个ipk的文件包。然后利用 opkg install xxx.ipk 来安装这个软件。<br>下面具体说下，如何编译一个helloword的软件包。<br>（1）首先，编写helloworld程序<br>编写helloworld.c<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/<span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line"><span class="bullet">* </span>Helloworld.c</span><br><span class="line"><span class="bullet">* </span>The most simplistic C program ever written.</span><br><span class="line"><span class="bullet">* </span>An epileptic monkey on crack could write this code.</span><br><span class="line"><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>**/</span></span></span><br><span class="line">#include</span><br><span class="line">#include</span><br><span class="line"><span class="built_in">int</span> main(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">printf(“Hell! O’ world, why won’t my code compile?\n\n”);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编写Makefile文件<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="selector-tag">build</span> <span class="selector-tag">helloworld</span> <span class="selector-tag">executable</span> <span class="keyword">when</span> user executes “make”</span><br><span class="line"><span class="attribute">helloworld</span>: helloworld.o</span><br><span class="line">$(CC) $(LDFLAGS) helloworld.o -o helloworld</span><br><span class="line">helloworld.<span class="attribute">o</span>: helloworld.c</span><br><span class="line">$(CC) $(CFLAGS) -c helloworld.c</span><br><span class="line"># remove object files <span class="keyword">and</span> executable <span class="keyword">when</span> user executes “make clean”</span><br><span class="line"><span class="attribute">clean</span>:</span><br><span class="line">rm *.o helloworld</span><br></pre></td></tr></table></figure></p>
<p>在这两个文件的目录下，执行make 应该可以生成helloworld的可执行文件。执行helloworld后，能够打印出“Hell! O’ world, why won’t my code compile?”。这一步，主要保证我们的源程序是可以正常编译的。下面我们将其移植到OpenWRT上。<br>（2）将OpenWrt-SDK-ar71xx-for-linux-i486-gcc-4.6-linaro_uClibc-0.9.33.2.tar.bz解压<br>tar –xvfOpenWrt-SDK-ar71xx-for-linux-i486-gcc-4.6-linaro_uClibc-0.9.33.2.tar.bz<br>（3）进入SDK<br>cd OpenWrt-SDK-ar71xx-for-linux-i486-gcc-4.6-linaro_uClibc-0.9.33.2.tar.bz<br>可以看到里面的目录结构跟我们之前source的目录结构基本相同，所需要编译的软件包，需要放置在package目录下<br>（4）在package目录下创建helloworld目录<br>cd package<br>mkdir helloworld<br>cd helloworld<br>（5）创建src目录，拷贝 helloworld文件<br>mkdir src<br>cp /home/wrt/test/helloworld.c src<br>cp /home/wrt/test/Makefile src<br>（6）在helloworld目录下创建Makefile文件<br>这个Makefile文件是给OpenWRT读的，而之前写的那个Makefile文件是针对helloworld给编译其读的。两个Makefile不在同一层目录下。<br>touch Makefile<br>vim Makefile<br>Makefile文件模板内容如下：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OpenWrt Makefile for helloworld program</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Most of the variables used here are defined in</span></span><br><span class="line"><span class="comment"># the include directives below. We just need to</span></span><br><span class="line"><span class="comment"># specify a basic description of the package,</span></span><br><span class="line"><span class="comment"># where to build our program, where to find</span></span><br><span class="line"><span class="comment"># the source files, and where to install the</span></span><br><span class="line"><span class="comment"># compiled program on the router.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Be very careful of spacing in this file.</span></span><br><span class="line"><span class="comment"># Indents should be tabs, not spaces, and</span></span><br><span class="line"><span class="comment"># there should be no trailing whitespace in</span></span><br><span class="line"><span class="comment"># lines that are not commented.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">##############################################</span></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(</span>TOPDIR)/rules.mk</span><br><span class="line"><span class="comment"># Name and release number of this package</span></span><br><span class="line"><span class="symbol">PKG_NAME:</span>=helloworld</span><br><span class="line"><span class="symbol">PKG_RELEASE:</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This specifies the directory where we’re going to build the program.</span></span><br><span class="line"><span class="comment"># The root build directory, $(BUILD_DIR), is by default the build_mipsel</span></span><br><span class="line"><span class="comment"># directory in your OpenWrt SDK directory</span></span><br><span class="line">PKG_BUILD_DIR <span class="symbol">:</span>= <span class="variable">$(</span>BUILD_DIR)/<span class="variable">$(</span>PKG_NAME)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="variable">$(</span>INCLUDE_DIR)/package.mk</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify package information for this program.</span></span><br><span class="line"><span class="comment"># The variables defined here should be self explanatory.</span></span><br><span class="line"><span class="comment"># If you are running Kamikaze, delete the DESCRIPTION</span></span><br><span class="line"><span class="comment"># variable below and uncomment the Kamikaze define</span></span><br><span class="line"><span class="comment"># directive for the description below</span></span><br><span class="line">define Package/helloworld</span><br><span class="line"><span class="symbol">SECTION:</span>=utils</span><br><span class="line"><span class="symbol">CATEGORY:</span>=Utilities</span><br><span class="line"><span class="symbol">TITLE:</span>=Helloworld — prints a snarky message</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment portion below for Kamikaze and delete DESCRIPTION variable above</span></span><br><span class="line">define Package/helloworld/description</span><br><span class="line">If you can’t figure out what this program does, you’re probably</span><br><span class="line">brain-dead <span class="keyword">and</span> need immediate medical attention.</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify what needs to be done to prepare for building the package.</span></span><br><span class="line"><span class="comment"># In our case, we need to copy the source files to the build directory.</span></span><br><span class="line"><span class="comment"># This is NOT the default. The default uses the PKG_SOURCE_URL and the</span></span><br><span class="line"><span class="comment"># PKG_SOURCE which is not defined here to download the source from the web.</span></span><br><span class="line"><span class="comment"># In order to just build a simple program that we have just written, it is</span></span><br><span class="line"><span class="comment"># much easier to do it this way.</span></span><br><span class="line">define Build/Prepare</span><br><span class="line">mkdir -p <span class="variable">$(</span>PKG_BUILD_DIR)</span><br><span class="line"><span class="variable">$(</span>CP) ./src/* <span class="variable">$(</span>PKG_BUILD_DIR)/</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line"><span class="comment"># We do not need to define Build/Configure or Build/Compile directives</span></span><br><span class="line"><span class="comment"># The defaults are appropriate for compiling a simple program such as this one</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Specify where and how to install the program. Since we only have one file,</span></span><br><span class="line"><span class="comment"># the helloworld executable, install it by copying it to the /bin directory on</span></span><br><span class="line"><span class="comment"># the router. The $(1) variable represents the root directory on the router running</span></span><br><span class="line"><span class="comment"># OpenWrt. The $(INSTALL_DIR) variable contains a command to prepare the install</span></span><br><span class="line"><span class="comment"># directory if it does not already exist. Likewise $(INSTALL_BIN) contains the</span></span><br><span class="line"><span class="comment"># command to copy the binary file from its current location (in our case the build</span></span><br><span class="line"><span class="comment"># directory) to the install directory.</span></span><br><span class="line">define Package/helloworld/install</span><br><span class="line"><span class="variable">$(</span>INSTALL_DIR) <span class="variable">$(</span><span class="number">1</span>)/bin</span><br><span class="line"><span class="variable">$(</span>INSTALL_BIN) <span class="variable">$(</span>PKG_BUILD_DIR)/helloworld <span class="variable">$(</span><span class="number">1</span>)/bin/</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line"><span class="comment"># This line executes the necessary commands to compile our program.</span></span><br><span class="line"><span class="comment"># The above define directives specify all the information needed, but this</span></span><br><span class="line"><span class="comment"># line calls BuildPackage which in turn actually uses this information to</span></span><br><span class="line"><span class="comment"># build a package.</span></span><br><span class="line"><span class="variable">$(</span>eval <span class="variable">$(</span>call BuildPackage,helloworld))</span><br></pre></td></tr></table></figure></p>
<p>（7）返回到SDK的根目录<br>执行make进行编译<br>编译过程会在build_dir目录下完成<br>编译结果会放在 bin/[yourtarget]/package目录下helloworld_1_ar71xx.ipk<br>（8）上传helloworld_1_ar71xx.ipk<br>使用winscp软件上传helloworld_1_ar71xx.ipk至路由器<br>执行 opkg install helloworld_1_ar71xx.ipk<br>输入helloworld<br>执行 helloworld 查看程序的效果。<br>Hell! O’ world, why won’t my code compile?</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openwrt/">openwrt</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-c语言大数相加-相乘" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/06/24/c语言大数相加-相乘/" class="article-date">
  	<time datetime="2014-06-25T00:13:00.000Z" itemprop="datePublished">2014-06-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/24/c语言大数相加-相乘/">c语言大数相加&amp;相乘</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>因为32位int类型最大的数是2147483647。所以在进行大数相加或者相乘的时候，会导致溢出。<br>下面是我自己写的大数相加&amp;相乘的程序。乘有两个版本，但是multiply_v1用的add叠加，导致速度太慢太慢。。<br>但是既然写好了就不扔了，放上面以后可能看看。。<br>multity_v2速度倒是蛮快的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 21.16*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">char</span> *number)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *head = number;</span><br><span class="line">    <span class="keyword">char</span> *num = number;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">99999</span>;</span><br><span class="line">    <span class="keyword">while</span>(*num != ‘\<span class="number">0</span>’)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>((*num &lt; ’<span class="number">0</span>′) || (*num &gt; ’<span class="number">9</span>′))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Input Error! I can’t count!\n"</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        num++;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    number[i] = ‘\<span class="number">0</span>’;</span><br><span class="line">    i–;</span><br><span class="line">    num–;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(num &gt;= head)</span><br><span class="line">    &#123;</span><br><span class="line">        number[i] = *num;</span><br><span class="line">        i–;</span><br><span class="line">        num–;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(;i &gt;=<span class="number">0</span>;i–)</span><br><span class="line">    &#123;</span><br><span class="line">    	number[i] = ’<span class="number">0</span>′;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">add</span><span class="params">(<span class="keyword">char</span> *num1,<span class="keyword">char</span> *num2)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> result[<span class="number">100000</span>];</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> carry = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *temp = result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">    	result[i] = ’<span class="number">0</span>′;</span><br><span class="line">    &#125;</span><br><span class="line">    result[<span class="number">99999</span>] = ‘\<span class="number">0</span>’;</span><br><span class="line"></span><br><span class="line">    prepare(num1);</span><br><span class="line">    prepare(num2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">99998</span>; i &gt;= <span class="number">0</span>; i–)</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="keyword">if</span>((num1[i] + num2[i] + carry – ’<span class="number">0</span>′) &gt; ’<span class="number">9</span>′)</span><br><span class="line">        &#123;</span><br><span class="line">            result[i] = num1[i] + num2[i] + carry – ’<span class="number">0</span>′ – <span class="number">10</span>;</span><br><span class="line">            carry = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            result[i] = num1[i] + num2[i] + carry – ’<span class="number">0</span>′;</span><br><span class="line">            carry = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span>(result[i] == ’<span class="number">0</span>′)</span><br><span class="line">    &#123;</span><br><span class="line">        temp++;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sheet</span><span class="params">(<span class="keyword">char</span> *num1,<span class="keyword">int</span> num2,<span class="keyword">char</span> *temp)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    prepare(temp);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">99998</span>;</span><br><span class="line">    <span class="keyword">int</span> carry = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> carry_temp[<span class="number">100000</span>];</span><br><span class="line">    <span class="keyword">char</span> *temp_temp = temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *head = num1;</span><br><span class="line">    <span class="keyword">while</span>(*num1 != ‘\<span class="number">0</span>’)</span><br><span class="line">    &#123;</span><br><span class="line">    	num1++;</span><br><span class="line">    &#125;</span><br><span class="line">    num1–;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(num1 &gt;= head)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">      temp[i] = ((*num1 – ’<span class="number">0</span>′)*num2 + carry) % <span class="number">10</span> + ’<span class="number">0</span>′;</span><br><span class="line">      carry = ((*num1 – ’<span class="number">0</span>′)*num2 + carry) / <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">      num1–;</span><br><span class="line">      i–;</span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(temp[i] == ’<span class="number">0</span>′)</span><br><span class="line">    &#123;</span><br><span class="line">        temp_temp++;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(carry_temp,temp_temp);</span><br><span class="line">    <span class="built_in">strcpy</span>(temp,carry_temp);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ten_multiply</span><span class="params">(<span class="keyword">char</span> *number,<span class="keyword">int</span> digit)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *p = number;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(*p != ‘\<span class="number">0</span>’)</span><br><span class="line">  &#123;</span><br><span class="line">  		p++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; digit; i++)</span><br><span class="line">  &#123;</span><br><span class="line">  		*p = ’<span class="number">0</span>′;</span><br><span class="line"> 		 p++;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  *p = ‘\<span class="number">0</span>’;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">multiply_v2</span><span class="params">(<span class="keyword">char</span> *num1,<span class="keyword">char</span> *num2)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> result[<span class="number">100000</span>] = <span class="string">"0"</span>;</span><br><span class="line">    <span class="keyword">char</span> result_temp[<span class="number">100000</span>] = <span class="string">"0"</span>;</span><br><span class="line">    <span class="keyword">char</span> *temp = result;</span><br><span class="line">    <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *num2_temp = num2;</span><br><span class="line">    <span class="keyword">char</span> *num2_head = num2;</span><br><span class="line">    <span class="keyword">while</span>(*num2_temp != ‘\<span class="number">0</span>’)</span><br><span class="line">    &#123;</span><br><span class="line">    	num2_temp++;</span><br><span class="line">    &#125;</span><br><span class="line">    num2_temp–;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(num2_temp &gt;= num2_head)</span><br><span class="line">    &#123;</span><br><span class="line">        sheet(num1,*num2_temp – ’<span class="number">0</span>′,result_temp);</span><br><span class="line">        ten_multiply(result_temp,number);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">strcpy</span>(result,add(result_temp,result));</span><br><span class="line">        number++;</span><br><span class="line">        num2_temp–;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(*temp == ’<span class="number">0</span>′)</span><br><span class="line">    &#123;</span><br><span class="line">   		 temp++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">multiply_v1</span><span class="params">(<span class="keyword">char</span> *num1,<span class="keyword">char</span> *num2)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> result[<span class="number">100000</span>] = <span class="string">"0"</span>;</span><br><span class="line">    <span class="keyword">char</span> result_temp[<span class="number">100000</span>] = <span class="string">"0"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *num2_temp = num2;</span><br><span class="line">    <span class="keyword">char</span> *num2_head = num2;</span><br><span class="line">    <span class="keyword">char</span> *temp = result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(*num2_temp != ‘\<span class="number">0</span>’)</span><br><span class="line">    &#123;</span><br><span class="line">    		num2_temp++;</span><br><span class="line">    &#125;</span><br><span class="line">    num2_temp–;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(num2_temp &gt;= num2_head)</span><br><span class="line">    &#123;</span><br><span class="line">          <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; ((*num2_temp – ’<span class="number">0</span>′)*<span class="built_in">pow</span>(<span class="number">10</span>,number<span class="number">-1</span>)); i++)</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="built_in">strcpy</span>(result_temp,add(result_temp,num1));</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">strcpy</span>(result,add(temp,result_temp));</span><br><span class="line">          <span class="built_in">strcpy</span>(result_temp,<span class="string">"0"</span>);</span><br><span class="line">          number++;</span><br><span class="line">          num2_temp–;</span><br><span class="line">    &#125;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(result[i] == ’<span class="number">0</span>′)</span><br><span class="line">    &#123;</span><br><span class="line">          temp++;</span><br><span class="line">          i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> num1[<span class="number">100000</span>];</span><br><span class="line">    <span class="keyword">char</span> num2[<span class="number">100000</span>];</span><br><span class="line">    <span class="keyword">char</span> result[<span class="number">100000</span>] = <span class="string">"1"</span>;</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Please input num1 :"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,num1);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Please input num2 :"</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,num2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"please input how do u want to count (+ or *) :"</span>);</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;c);</span><br><span class="line">    <span class="keyword">if</span>(c == ‘+’)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(result,add(num1,num2));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"num + num2 = %s\n"</span>,result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(c == ‘*’)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(result,multiply_v2(num1,num2));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"num * num2 = %s\n"</span>,result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    		<span class="built_in">printf</span>(<span class="string">"Input error!\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C语言/">C语言</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-AR9331-AR9344-网口、Led修正方法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/05/14/AR9331-AR9344-网口、Led修正方法/" class="article-date">
  	<time datetime="2014-05-14T14:23:00.000Z" itemprop="datePublished">2014-05-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/05/14/AR9331-AR9344-网口、Led修正方法/">AR9331/AR9344 网口、Led修正方法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>不同的openwrt版本可能不太一样，但是大致差不多。以官方attitude_adjustment版本为例。</p>
<p>#注:在改代码之前请先make clean。</p>
<p>AR9331网口修正方法：以编译tl-wr741n-v4固件为例，找到文件mach-tl-wr741nd-v4.c，在目录attitude_adjustment/target/linux/ar71xx/files/arch/mips/ath79/下，找到代码<br>ath79_setup_ar933x_phy4_switch(true, true); 改为ath79_setup_ar933x_phy4_switch(false, false);或者直接删掉。</p>
<p>AR9331 Led修正方法 ：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tl-wr741nd-v4</span>)</span><br><span class="line"><span class="selector-tag">ucidef_set_led_netdev</span> “<span class="selector-tag">wan</span>” “<span class="selector-tag">WAN</span>” “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:wan</span>” “<span class="selector-tag">eth1</span>″</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan1</span>″ “<span class="selector-tag">LAN1</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan1</span>″ “<span class="selector-tag">switch0</span>″ “0×04”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan2</span>″ “<span class="selector-tag">LAN2</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan2</span>″ “<span class="selector-tag">switch0</span>″ “0×08”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan3</span>″ “<span class="selector-tag">LAN3</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan3</span>″ “<span class="selector-tag">switch0</span>″ “0×10”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan4</span>″ “<span class="selector-tag">LAN4</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan4</span>″ “<span class="selector-tag">switch0</span>″ “0×02”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_wlan</span> “<span class="selector-tag">wlan</span>” “<span class="selector-tag">WLAN</span>” “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:wlan</span>” “<span class="selector-tag">phy0tpt</span>”</span><br></pre></td></tr></table></figure></p>
<p>改成<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ucidef_set_led_netdev</span> “<span class="selector-tag">wan</span>” “<span class="selector-tag">WAN</span>” “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:wan</span>” “<span class="selector-tag">eth1</span>″</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan1</span>″ “<span class="selector-tag">LAN1</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan1</span>″ “<span class="selector-tag">switch0</span>″ “0×02”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan2</span>″ “<span class="selector-tag">LAN2</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan2</span>″ “<span class="selector-tag">switch0</span>″ “0×04”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan3</span>″ “<span class="selector-tag">LAN3</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan3</span>″ “<span class="selector-tag">switch0</span>″ “0×08”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_switch</span> “<span class="selector-tag">lan4</span>″ “<span class="selector-tag">LAN4</span>″ “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:lan4</span>″ “<span class="selector-tag">switch0</span>″ “0×10”</span><br><span class="line"><span class="selector-tag">ucidef_set_led_wlan</span> “<span class="selector-tag">wlan</span>” “<span class="selector-tag">WLAN</span>” “<span class="selector-tag">tp-link</span><span class="selector-pseudo">:green</span><span class="selector-pseudo">:wlan</span>” “<span class="selector-tag">phy0tpt</span>”</span><br></pre></td></tr></table></figure></p>
<p>AR9341网口修正方法：以编译tl-wr841n-v8固件为例，在刚才的目录下找到文件mach-tl-wr841n-v8.c，将代码<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ath<span class="number">79</span>_setup_ar<span class="number">934</span>x_eth_cfg<span class="comment">(AR934X_ETH_CFG_SW_PHY_SWAP)</span>;改为ath<span class="number">79</span>_setup_ar<span class="number">934</span>x_eth_cfg<span class="comment">(AR934X_ETH_CFG_SW_ONLY_MODE)</span>;</span><br><span class="line">ath<span class="number">79</span>_switch_data.phy_poll_mask = BIT<span class="comment">(0)</span>;</span><br></pre></td></tr></table></figure></p>
<p>改为<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ath<span class="number">79</span>_switch_data.phy_poll_mask = BIT<span class="comment">(4)</span>;</span><br><span class="line">ath<span class="number">79</span>_eth<span class="number">0</span>_data.phy_mask = BIT<span class="comment">(0)</span>;改为ath<span class="number">79</span>_eth<span class="number">0</span>_data.phy_mask = BIT<span class="comment">(4)</span>;</span><br></pre></td></tr></table></figure></p>
<p>此项为修改内核的方法，不会随着make clean而被还原。</p>
<p>上述修改方法适用于pppoe拨号、DHCP动态IP地址和静态IP地址环境。<br>led灯的修正请根据具体机型修改匹配。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openwrt/">openwrt</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-关于我" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/03/20/关于我/" class="article-date">
  	<time datetime="2014-03-20T23:01:00.000Z" itemprop="datePublished">2014-03-20</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/03/20/关于我/">关于我</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>博客搭建在GitPage上，地址是 bwelco.github.com<br>Hexo是静态网页，访问起来速度很快，再加上GitPage不收费，是个人博客的好选择。<br>原来的博客会慢慢迁移过来。就这样。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 bwelco
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>